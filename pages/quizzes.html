<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/quizzes.css">
    <title>Quizes</title>
</head>
<body>
    <div id="content">
        <!-- <nav id="quiz-nav">
            <ul>
                <li>Animals</li>
                <li>Colors</li>
                <li>Food & Drink</li>
                <li>Body</li>
                <li>House</li>
                <li>Nature</li>

            </ul>
        </nav> -->
        
        <h1>これはなんですか？</h1>
        <div id="visual-ctn"></div>
        <div id="hints-ctn"></div>

        <form id="answer-ctn">
            <div id="answer-icon">
                <i class="fa-regular fa-circle"></i>
            </div>
            <input type="text" name="" id="text-box">        
            <button id="submit-answer">
                <i class="fa-regular fa-circle-right"></i>
            </button>
        </form>

        <div id="progress-bar"></div>
    </div>

    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/867dfd702e.js" crossorigin="anonymous"></script>

    <!-- Quiz -->
    <script type="module">
        // Import
        import { animalQuestions } from '../data/data.js';

        // Initializations
        let shuffledQuestions = [];
        let currentQuestion = {};
        let questionIndex = 0;

        // Page Elements
        const visualCtn = document.querySelector('#visual-ctn');
        const hintsCtn = document.querySelector('#hints-ctn');
        const quizForm = document.querySelector('form');

        // Functions
        function fisherYatesShuffle(arr) {
            let newArr = [...arr];

            for(let i = arr.length-1; i >= 0; i--) {
                let j = Math.floor(Math.random() * (i+1));

                [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
            }

            return newArr;
        }
        
        function setupPage(question) {
            // Clear textbox, hints, reset answer icon
            document.querySelector('#text-box').value = '';
            hintsCtn.innerHTML = '';            

            // Set image/emoji
            visualCtn.innerText = question.visual;

            // create a button hiding each character of the answer in hiragana
            for(let char of question.answer) {
                const hint = document.createElement('button');
                hint.innerText = char;

                hint.addEventListener('click', (e) => {                    
                    // Turn button text white on click
                    e.target.classList.add('text-reveal');
                });

                // Add to hints container
                hintsCtn.appendChild(hint);
            }
        }

        // Shuffle deck, set question
        shuffledQuestions = fisherYatesShuffle(animalQuestions);
        currentQuestion = shuffledQuestions[questionIndex];

        // Setup page on load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Page Loaded');            
            setupPage(currentQuestion);
        });

        // Handle submission
        quizForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const myAnswer = document.querySelector('#text-box').value;
            const answerIcon = document.querySelector('#answer-icon');

            if(myAnswer === currentQuestion.answer) {
                answerIcon.innerHTML = '<i class="fa-regular fa-circle-check"></i>';
                const progressBar = document.querySelector('#progress-bar');
                progressBar.classList.add('animate'); 
                
                // If answered last question
                if(questionIndex === shuffledQuestions.length - 1) {                    
                    document.querySelector('#content').innerHTML = '<h1>Quiz Complete</h1><button id="return-btn"><a href="/index.html" target="_self">Return</a></button>';
                    return;
                }                

                // Setup next page after 1 second
                const setupTimer = setTimeout(() => {
                    answerIcon.innerHTML = '<i class="fa-regular fa-circle"></i>';
                    questionIndex += 1;
                    currentQuestion = shuffledQuestions[questionIndex];
                    setupPage(currentQuestion)
                    clearTimeout(setupTimer)
                    progressBar.classList.remove('animate');
                }, 1000);
            } else {
                answerIcon.innerHTML = '<i class="fa-regular fa-circle-xmark"></i>';
            }

        })
    </script>
</body>
</html>